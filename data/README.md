
# Data Folder Overview

This folder contains all raw, processed, and derived data used across the Skin IHC / Epidermis Analysis pipeline.  
It is organized to separate original data, preprocessed data, model outputs, and analysis results.

## Folder Structure

```plaintext
data/
├── raw/
├── processed/
├── v001/
│ ├── training/
│ ├── predictions/
│ ├── cellpose/
│ └── layer_analysis/
```

---

## `raw/`
```plaintext
fileTypes = .jpg, .jpeg, .tif, .tiff, .png, .bmp
```
- Contains the original, unprocessed input files.  
- Typical contents:
  - **Images:** `fileTypes` (H&E or IHC stained tissue sections)
  - **Masks:** `fileTypes` RGB images where each channel/class encodes tissue types 

---

## `processed/`

- Stores preprocessed images and intermediate data for downstream analyses.  
- Expected subfolders and formats:

  | Subfolder          | Description                                      | File format              |
  |-------------------|-------------------------------------------------|-------------------------|
  | `images_HnE/`      | Cropped H&E stained ROI images                  | `fileTypes`          |
  | `roi_xy/`          | ROI coordinates                                  | `.json`, `.npz`         |
  | `images_IHC/`      | IHC images ready for analysis                   | `fileTypes`          |
  | `masks/`           | Tissue masks generated by prediction pipeline  | `.npz` (contains `mask` array) |

---

## `v001/` (Versioned Outputs)

- Stores outputs for a specific version of the pipeline (`v001`).  
- Allows reproducibility for different analyses or model versions.  

### Subfolders

| Subfolder           | Description                                                   | File Format / Notes                              |
|--------------------|---------------------------------------------------------------|-------------------------------------------------|
| `training/`         | Training data for deep learning models                        | Images, masks |
| `predictions/`      | Model predictions on new or validation data                  | `.npz` masks, probability maps                  |
| `cellpose/`         | Cell segmentation outputs from `ihc_cellpose.py`             | `.npz` files containing `mask` arrays          |
| `layer_analysis/`   | Epidermal layer analysis results from `cell_layers_database.py` | Figures (`.png`), JSON metadata (`run_metadata.json`) |


---

## Naming Conventions

- All images and masks should follow this convention:


```plaintext
<tissue_id>-<image_id>.png
<tissue_id>-<image_id>.npz
```


- `tissue_id` and `image_id` are derived from the HPA database to ensure consistency.

---

## Recommended Workflow

    1. Place raw H&E or IHC images into `raw/`.  
    2. Preprocess images to populate `processed/`.  
    3. Run model predictions to populate `v001/predictions/`.  
    4. Run `ihc_cellpose.py` to generate cell masks in `v001/cellpose/`.  
    5. Run `cell_layers_database.py` to compute layered epidermis analysis and save figures/metadata in `v001/layer_analysis/`.  

---

## Notes

- Versioned folders (`v001`, `v002`, etc.) ensure that analyses are reproducible and traceable.  
- All scripts are in `scripts/` and rely on consistent paths defined in `config/`.  
- Figures and analysis outputs should always include the main ID and, if available, the gene name.  



